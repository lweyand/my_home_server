---

- name: Firewall| Set Interfaces
  set_fact:
    exter_if: "{{ ansible_facts.default_ipv4.interface }}"
    exter_ip: "{{ ansible_facts.default_ipv4.address }}"

- name: Firewall| Create iptables file
  template:
    src: templates/iptables/iptables.j2
    dest: "{{ firewall.file }}"
  register: iptables_tpl
  notify: restart iptables

- name: Firewall| Validate iptables configuration
  shell: "iptables-restore -v --test < {{ firewall.file }}"
  register: iptables_rest
  changed_when: "iptables_rest.rc == 0"
  failed_when: "iptables_rest.rc > 0"
  when: "iptables_tpl.changed == true"