---

- hosts: debian
  gather_facts: Yes
  remote_user: root

  tasks:
    - name: include os tasks
      include: includes/os.yaml
      tags:
        - os
    - name: include users tasks
      include: includes/users.yaml
      tags:
        - users
    - name: include directories tasks
      include: includes/directories.yaml
      tags:
        - os
        - dir
    - name: include firewall tasks
      include:  includes/firewall.yaml
      tags:
        - frwl
    - name: include samba tasks
      include: includes/samba.yaml
      tags:
        - smb
    - name: include ftp tasks
      include: includes/ftp.yaml
      tags:
        - ftp
    - name: include certbot tasks
      include: includes/certbot.yaml
      tags:
        - crt
    - name: include httpd tasks
      include: includes/http.yaml
      tags:
        - http

  handlers:
    - name: restart samba
      service:
        name: smbd
        state: restarted
    - name: restart httpd
      service:
        name: apache2
        state: restarted
    - name: restart ftp
      service:
        name: proftpd
        state: restarted
    - name: restart sshd
      service:
        name: sshd
        state: reloaded
    - name: restart iptables
      command: service netfilter-persistent reload
#        warn: false
      register: iptables
#      command_warnings: False
      changed_when: "iptables.rc == 0"
      failed_when: "iptables.rc > 0"